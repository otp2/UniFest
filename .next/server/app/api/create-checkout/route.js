(()=>{var e={};e.id=763,e.ids=[763],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var s=r(34386),a=r(44999);async function i(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!t)throw Error("Missing Supabase environment variables");let r=await (0,a.UL)();return(0,s.createServerClient)(e,t,{cookies:{getAll:()=>r.getAll(),setAll(e){try{e.forEach(({name:e,value:t,options:s})=>r.set(e,t,s))}catch{}}}})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73998:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>_,serverHooks:()=>x,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>l,dynamic:()=>p});var a=r(96559),i=r(48088),o=r(37719),n=r(32190),c=r(97877),u=r(56621);let p="force-dynamic",d=new c.A(process.env.STRIPE_SECRET_KEY);async function l(e){try{let{promoCode:t,buyerEmail:r}=await e.json(),s=await (0,u.z)(),{data:a}=await s.from("houses").select("*").eq("promo_code",t).single();if(!a||a.tickets_sold>=a.ticket_cap)return n.NextResponse.json({error:"No tickets available"},{status:400});let{data:i}=await s.from("settings").select("value").eq("key","pricing_config").single(),o=i?.value||{early_bird_deadline:"2024-08-15T23:59:59Z",prices:{fraternity_early:12e3,fraternity_late:14e3,sorority_early:7500,sorority_late:1e4}},c=new Date<new Date(o.early_bird_deadline),p=`${a.house_type}_${c?"early":"late"}`,l=o.prices[p],_=await d.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:`UniFest 2024 - ${a.display_name}`},unit_amount:l},quantity:1}],mode:"payment",success_url:`${process.env.NEXT_PUBLIC_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.NEXT_PUBLIC_URL}/tickets/${t}`,customer_email:r,metadata:{house_id:a.id,promo_code:t}});return n.NextResponse.json({sessionId:_.id})}catch(e){return console.error("Checkout creation error:",e),n.NextResponse.json({error:"Failed to create checkout session"},{status:500})}}let _=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/create-checkout/route",pathname:"/api/create-checkout",filename:"route",bundlePath:"app/api/create-checkout/route"},resolvedPagePath:"C:\\Users\\16308\\Downloads\\UniFest\\src\\app\\api\\create-checkout\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:m,serverHooks:x}=_;function h(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:m})}},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},93939:e=>{"use strict";e.exports=require("@supabase/supabase-js")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,410,580,374],()=>r(73998));module.exports=s})();