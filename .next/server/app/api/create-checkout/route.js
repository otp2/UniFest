"use strict";(()=>{var e={};e.id=565,e.ids=[565],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},3135:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{POST:()=>l,dynamic:()=>p});var o=t(9303),a=t(8716),n=t(3131),i=t(7070),c=t(1059),u=t(1926);let p="force-dynamic";async function l(e){try{let{promoCode:r,buyerEmail:t}=await e.json(),s=await (0,u.f)(),{data:o}=await s.from("houses").select("*").eq("promo_code",r).single();if(!o||o.tickets_sold>=o.ticket_cap)return i.NextResponse.json({error:"No tickets available"},{status:400});let{data:a}=await s.from("settings").select("value").eq("key","pricing_config").single(),n=a?.value||{early_bird_deadline:"2024-08-15T23:59:59Z",prices:{fraternity_early:12e3,fraternity_late:14e3,sorority_early:7500,sorority_late:1e4}},p=new Date<new Date(n.early_bird_deadline),l=`${o.house_type}_${p?"early":"late"}`,d=n.prices[l],_=function(){if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set");return new c.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-04-30.basil"})}(),E=await _.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:`UniFest 2024 - ${o.display_name}`},unit_amount:d},quantity:1}],mode:"payment",success_url:`${process.env.NEXT_PUBLIC_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.NEXT_PUBLIC_URL}/tickets/${r}`,customer_email:t,metadata:{house_id:o.id,promo_code:r}});return i.NextResponse.json({sessionId:E.id})}catch(e){return console.error("Checkout creation error:",e),i.NextResponse.json({error:"Failed to create checkout session"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/create-checkout/route",pathname:"/api/create-checkout",filename:"route",bundlePath:"app/api/create-checkout/route"},resolvedPagePath:"C:\\Users\\16308\\Downloads\\UniFest\\src\\app\\api\\create-checkout\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:E,serverHooks:x}=d,m="/api/create-checkout/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:E})}},1926:(e,r,t)=>{t.d(r,{f:()=>a});var s=t(8641),o=t(1615);async function a(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!r)throw console.error("Environment variables debug:",{supabaseUrl:e?"SET":"MISSING",supabaseAnonKey:r?"SET":"MISSING",allEnvVars:Object.keys(process.env).filter(e=>e.includes("SUPABASE")),nodeEnv:"production"}),Error("Missing Supabase environment variables: NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are required");let t=await (0,o.cookies)();return(0,s.createServerClient)(e,r,{cookies:{getAll:()=>t.getAll(),setAll(e){try{e.forEach(({name:e,value:r,options:s})=>t.set(e,r,s))}catch{}}}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,573,972,59],()=>t(3135));module.exports=s})();